<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'zh-TW' }}">

  <head>
    {% include head.html %}
    <link rel="icon" type="image/png" href="{{ '/assets/icons/warmycat.png' | relative_url }}">
    {% if site.google_analytics %}
      {% include google-analytics.html %}
    {% endif %}
    <script>
      /* 立即檢查模式，防止頁面跳轉時閃爍白光 */
      (function() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
      })();
    </script>

    <style>
      /* --- 1. 全站寬度與 Header 對齊 --- */
      .site-header__inner, .wrapper {
        max-width: 1200px !important;
        margin: 0 auto;
        padding: 0 20px;
      }
    
      /* --- 2. Header 佈局控制 --- */
      .site-header__inner {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        padding: 10px 20px;
      }
    
      .site-header__logo-link {
        order: 1 !important;
        margin-right: 20px;
        flex-shrink: 0;
      }
    
      .search-container {
        order: 2 !important;
        flex: 1 1 200px;
        position: relative;
        margin: 5px 0;
      }
    
      #search-input {
        background-color: var(--bg-color);
        color: var(--text-color);
        width: 100%;
        box-sizing: border-box;
        padding: 8px 15px;
        border: 1px solid #ddd;
        border-radius: 20px;
      }
    
      .header-actions {
        order: 3 !important;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: 20px;
      }
    
      /* --- 3. 精選文章側邊欄 (修正靠左對齊) --- */
      .page-layout { 
        display: flex; 
        flex-wrap: wrap; 
        gap: 60px; 
        justify-content: flex-start; 
        margin-top: 20px; 
      }
      .page-content {
        background-color: var(--bg-color) !important;
      }
      .main-content { 
        background-color: var(--bg-color) !important;
        flex: 0 0 800px; 
        max-width: 800px; 
        width: 100%; }
      .sidebar { 
        flex: 1; 
        min-width: 250px; 
        max-width: 300px; 
        margin-top: 20px; 
        background-color: var(--bg-color);
        color: var(--text-color);
      }
      .sidebar-sticky { 
        position: sticky; 
        top: 40px; }
    
      /* 標題風格：4px 邊框 + 12px 內距 = 16px 的文字起始點 */
      .featured-title { 
        font-size: 1.25rem; 
        font-weight: 700; 
        color: var(--heading-color); 
        margin-bottom: 1.5rem; 
        border-left: 4px solid #9cdba2; 
        padding-left: 12px; 
        line-height: 1.2;
        text-align: left; /* 確保標題靠左 */
      }
    
      .featured-list { 
        list-style: none; 
        padding: 0; 
        margin: 0; 
        text-align: left !important; /* 強制列表文字靠左 */
      }
    
      .featured-list li { 
        /* 設定左側內距為 16px，使其與上方標題文字完美對齊 */
        padding: 12px 0 12px 16px; 
        border-bottom: 1px solid var(--border-color); 
      }
    
      .featured-list li:last-child { border-bottom: none; }
    
      .featured-list a { 
        text-decoration: none; 
        color: var(--text-color) !important; 
        font-size: 1.05rem; 
        font-weight: 500; 
        display: block; 
        line-height: 1.4;
      }
      .featured-list a:hover { color: #2d5a27; }
    
      /* --- 4. 響應式適應 --- */
      @media (max-width: 850px) {
        .search-container {
          order: 4 !important; 
          flex: 0 0 100%; 
          margin-top: 10px; 
        }
        .header-actions { 
          margin-left: auto; 
        }
        .page-layout {
          flex-direction: column; 
        }
        .main-content, .sidebar { 
          max-width: 100%;
          width: 100%; 
        }
        .sidebar { 
          order: 2; 
          border-top: 1px solid #eee; 
          padding-top: 30px; 
        }
      }
    
      /* --- 5. 下拉選單與圖示樣式 --- */
      .icon-btn, .dropdown-trigger { 
        width: 40px; 
        height: 40px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        border-radius: 50%; 
        transition: 0.2s; 
        color: #828282; 
      }
      .icon-btn:hover, .dropdown-trigger:hover { 
        background: rgba(0,0,0,0.05); 
      }
      .icon-btn img { 
        width: 24px; 
        height: 24px; 
      }
      .header-dropdown { 
        position: relative;
      }
      .header-dropdown:hover .dropdown-content { 
        display: block; 
        opacity: 1; 
        visibility: visible; 
        transform: translateY(0); 
      }
      .dropdown-content { 
        display: none;
        position: absolute;
        right: 0; top: 100%; 
        background-color: var(--card-bg) !important;
        min-width: 200px; 
        box-shadow: 0 8px 16px rgba(0,0,0,0.1); 
        border-radius: 12px;
        border: 1px solid var(--border-color);
        z-index: 1001; opacity: 0; 
        visibility: hidden; 
        transform: translateY(10px); 
      }
      .dropdown-content a { 
        color: var(--text-color);
        padding: 12px 20px; 
        text-decoration: none; 
        display: block;
        border-bottom: 1px solid #f9f9f9; 
      }
      .dropdown-content a:last-child {
        border-bottom: none !important;
      }
    </style>
  </head>

  <body>
    {% include header.html %}

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        
        <div class="page-layout">
          
          <div class="main-content">
            {{ content }}
          </div>

          <aside class="sidebar">
            <div class="sidebar-sticky">
              
              <h2 class="featured-title">精選文章</h2>
              
              <ul class="featured-list">
                {% if site.data.featured %}
                  {% for item in site.data.featured %}
                    <li>
                      <a href="{{ item.url | relative_url }}">
                        {{ item.title | escape }}
                      </a>
                    </li>
                  {% endfor %}
                {% endif %}
              </ul>

            </div>
          </aside>

        </div>

      </div>
    </main>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const toggleBtn = document.getElementById('dark-mode-toggle');
        const dropdownContent = document.querySelector('.dropdown-content');
        const parentDropdown = document.querySelector('.dropdown');
        
        // 圖示與文字元素
        const aboutmeIcon = document.getElementById('aboutme-icon');
        const toolIcon = document.getElementById('tool-icon');
        const toggleIcon = document.getElementById('toggle-icon');
        const toggleText = document.getElementById('toggle-text');
    
        function updateThemeUI(theme) {
          if (theme === 'dark') {
            if (aboutmeIcon) aboutmeIcon.src = "{{ '/assets/icons/aboutme_night.png' | relative_url }}";
            if (toolIcon) toolIcon.src = "{{ '/assets/icons/tool_night.png' | relative_url }}";
            if (toggleIcon) toggleIcon.src = "{{ '/assets/icons/day.png' | relative_url }}";
            if (toggleText) toggleText.textContent = "切換淺色模式";
          } else {
            if (aboutmeIcon) aboutmeIcon.src = "{{ '/assets/icons/aboutme_day.png' | relative_url }}";
            if (toolIcon) toolIcon.src = "{{ '/assets/icons/tool_day.png' | relative_url }}";
            if (toggleIcon) toggleIcon.src = "{{ '/assets/icons/night.png' | relative_url }}";
            if (toggleText) toggleText.textContent = "切換深色模式";
          }
        }
    
        // 初始化 UI
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
        updateThemeUI(currentTheme);
    
        if (toggleBtn && dropdownContent) {
          // 1. 點擊切換模式
          toggleBtn.addEventListener('click', function(e) {
            e.stopPropagation(); // 阻止冒泡，避免觸發 document 的 click
    
            const nowTheme = document.documentElement.getAttribute('data-theme');
            const targetTheme = nowTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', targetTheme);
            localStorage.setItem('theme', targetTheme);
            updateThemeUI(targetTheme);
    
            // 強制隱藏選單
            dropdownContent.classList.add('force-hide');
          });
    
          // 2. 智慧重置邏輯 (解決電腦版鎖死)
          if (parentDropdown) {
            // 當滑鼠在漢堡包容器上「移動」時，就檢查是否要解除鎖定
            parentDropdown.addEventListener('mousemove', function() {
              if (dropdownContent.classList.contains('force-hide')) {
                // 只要滑鼠有在移動，就移除強制隱藏，讓 CSS 的 :hover 重新接管
                dropdownContent.classList.remove('force-hide');
              }
            });
    
            // 滑鼠離開容器時也確保重置
            parentDropdown.addEventListener('mouseleave', function() {
              dropdownContent.classList.remove('force-hide');
            });
          }
    
          // 3. 全域點擊重置 (對手機版友善)
          document.addEventListener('click', function() {
            dropdownContent.classList.remove('force-hide');
          });
        }
      });
    </script>
    
    {% include footer.html %}
  </body>

</html>
